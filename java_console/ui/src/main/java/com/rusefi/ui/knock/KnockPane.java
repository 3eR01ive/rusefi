package com.rusefi.ui.knock;

import com.devexperts.logging.Logging;
import com.rusefi.FileLog;
import com.rusefi.config.generated.Fields;
import com.rusefi.core.EngineState;
import com.rusefi.core.preferences.storage.Node;
import com.rusefi.ui.RpmLabel;
import com.rusefi.ui.RpmModel;
import com.rusefi.ui.UIContext;
import com.rusefi.ui.config.ConfigUiField;
import com.rusefi.ui.util.UiUtils;
import com.rusefi.ui.widgets.AnyCommand;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.geom.Point2D;

import static com.devexperts.logging.Logging.getLogging;
import static com.rusefi.config.generated.KnockController.M_KNOCKFREQUENCY;
import static java.lang.Math.log;

/**
 * Date: 20/02/24
 * Aleksey Ershov, (c) 2013-2024
 */
public class KnockPane {
    private static final Logging log = getLogging(KnockPane.class);

    private final KnockCanvas canvas = new KnockCanvas();


    private final JPanel content = new JPanel(new BorderLayout());
    private final AnyCommand command;

    private boolean paused = false;

    public KnockPane(UIContext uiContext, Node config) {

        uiContext.getLinkManager().getEngineState().registerStringValueAction(Fields.PROTOCOL_KNOCK_SPECTROGRAMM, new EngineState.ValueCallback<String>() {
            @Override
            public void onUpdate(String value) {
                processValues(value);
            }
        });


        final JPanel upperPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 5, 0));
        final JButton pauseButton = UiUtils.createPauseButton();

        JButton clearButton = UiUtils.createClearButton();
        clearButton.addActionListener(new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) {
                UiUtils.trueRepaint(canvas);
                setPaused(pauseButton, false);
            }
        });
        upperPanel.add(clearButton);

        JButton saveImageButton = UiUtils.createSaveImageButton();
        upperPanel.add(saveImageButton);
        saveImageButton.addActionListener(new ActionListener() {
                                          @Override
                                          public void actionPerformed(ActionEvent e) {
                                              int rpm = RpmModel.getInstance().getValue();
                                              String fileName = FileLog.getDate() + "_knock_" + rpm + "_spectrogramm" + ".png";

                                              UiUtils.saveImageWithPrompt(fileName, upperPanel, canvas);
                                          }
                                      }
        );

        upperPanel.add(pauseButton);
        upperPanel.add(new RpmLabel(uiContext,2).getContent());

        command = AnyCommand.createField(uiContext, config, true, false);
        upperPanel.add(command.getContent());

        pauseButton.addActionListener(new ActionListener() {
                                                  @Override
                                                  public void actionPerformed(ActionEvent e) {
                                                      setPaused(pauseButton, !paused);
                                                  }
                                              }
        );

        content.add(upperPanel, BorderLayout.NORTH);

        content.add(canvas, BorderLayout.CENTER);

        final JPanel lowerPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 5, 0));
        lowerPanel.setBorder(BorderFactory.createLineBorder(Color.cyan));
        content.add(lowerPanel, BorderLayout.SOUTH);

        lowerPanel.add(new ConfigUiField(uiContext, M_KNOCKFREQUENCY, "Knock main frequency").getContent());
    }

    private void setPaused(JButton pauseButton, boolean isPaused) {
        paused = isPaused;
        UiUtils.setPauseButtonText(pauseButton, paused);
    }

    private void processValues(String values) {
        // THIS IS NOT CALL
        log.info(values);
    }

    public JComponent getPanel() {
        return content;
    }

    public ActionListener getTabSelectedListener() {
        return new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                command.requestFocus();
            }
        };
    }

    private class KnockCanvas extends JComponent {

        double[][] test_data;
        Color[] colorspace;
        Color[] colors;
        float[] values;

        static int SIZE = 256;
        static int VIEW_SIZE = 60; // 25207.5kHz

        double yAxisHz[];

        private KnockCanvas() {

            colors = new Color[VIEW_SIZE];
            values = new float[VIEW_SIZE];

            //background-image: linear-gradient(to right, #d16b6b, #d46f8a, #ce79a9, #bf86c4, #a995d8, #96a4e8, #80b2f3, #69bff8, #52cffe, #41dfff, #46eefa, #5ffbf1);
            colorspace = new Color[] {
                Color.decode("#d16b6b"),
                Color.decode("#d46f8a"),
                Color.decode("#ce79a9"),
                Color.decode("#bf86c4"),
                Color.decode("#a995d8"),
                Color.decode("#96a4e8"),
                Color.decode("#80b2f3"),
                Color.decode("#69bff8"),
                Color.decode("#52cffe"),
                Color.decode("#41dfff"),
                Color.decode("#46eefa"),
                Color.decode("#5ffbf1"),
            };

            yAxisHz = new double[]{
                0,
                427.246,
                854.492,
                1281.74,
                1708.98,
                2136.23,
                2563.48,
                2990.72,
                3417.97,
                3845.21,
                4272.46,
                4699.71,
                5126.95,
                5554.2,
                5981.45,
                6408.69,
                6835.94,
                7263.18,
                7690.43,
                8117.68,
                8544.92,
                8972.17,
                9399.41,
                9826.66,
                10253.9,
                10681.2,
                11108.4,
                11535.6,
                11962.9,
                12390.1,
                12817.4,
                13244.6,
                13671.9,
                14099.1,
                14526.4,
                14953.6,
                15380.9,
                15808.1,
                16235.4,
                16662.6,
                17089.8,
                17517.1,
                17944.3,
                18371.6,
                18798.8,
                19226.1,
                19653.3,
                20080.6,
                20507.8,
                20935.1,
                21362.3,
                21789.6,
                22216.8,
                22644,
                23071.3,
                23498.5,
                23925.8,
                24353,
                24780.3,
                25207.5,
            };

            test_data = new double[][]{
                {0,0,0,0,0,0,0,0,0,0},
                {0.212158,0.0305986,0.137633,0.118162,0.154026,0.142405,0.149015,0.00457018,0.170725,0.0803157},
                {0.425156,0.0611723,0.27602,0.236596,0.308402,0.285033,0.298338,0.00930868,0.341908,0.160766},
                {0.639601,0.0916295,0.415958,0.356614,0.463412,0.428199,0.448214,0.0143945,0.513859,0.241364},
                {0.856228,0.122015,0.557978,0.481685,0.619436,0.573433,0.598927,0.0179335,0.686949,0.322252},
                {1.07594,0.152171,0.702658,0.624812,0.776705,0.72435,0.750846,0.0147768,0.861592,0.403426},
                {1.29946,0.182116,0.848597,0.80847,0.935697,0.894437,0.90425,0.0121155,1.03827,0.485086},
                {1.52741,0.211675,0.990592,0.274371,1.09664,1.10543,1.0612,0.0168186,1.21731,0.567186},
                {1.76016,0.242154,1.1105,75.6461,1.26147,0.492498,1.22483,25.8709,1.40061,0.651336},
                {1.99612,0.275883,1.24132,620.238,1.43383,75.1967,1.40875,401.869,1.59178,0.740793},
                {2.22918,0.322539,10.2099,1727.2,1.62661,589.635,1.63343,1591.72,1.80314,0.847851},
                {2.46234,0.40181,189.022,2121.37,1.85934,1603.98,0.946992,2610.93,2.05221,0.995037},
                {4.30946,0.0884631,888.525,1209.44,1.1434,1928.22,73.6322,1986.17,1.30975,0.505873},
                {44.5842,70.81,1639.83,276.605,72.1494,1076.45,551.456,660.806,68.6754,75.5501},
                {255.996,660.075,1403.84,16.9703,527.67,238.125,1468.5,69.7113,484.583,636.329},
                {508.017,1975.12,532.263,2.22311,1389.63,14.7223,1729.2,0.329544,1253.91,1803.91},
                {477.246,2583.1,72.7828,2.43185,1618.57,2.82363,946.728,0.00122021,1435.62,2249.25},
                {194.007,1568.31,1.85366,2.68474,877.17,3.08831,202.348,0.0401032,765.587,1302.52},
                {34.8885,392.647,2.98759,2.92682,183.977,3.39077,13.0504,0.0508575,155.725,304.485},
                {4.29687,25.7876,3.18909,3.18122,12.2344,3.6872,3.56618,0.0504812,10.9536,19.0829},
                {5.34723,0.842169,3.44463,3.4583,3.91462,4.001,3.87542,0.0476392,4.33056,2.08226},
                {5.7555,0.879187,3.73777,3.76395,4.24685,4.3435,4.21719,0.0455734,4.6995,2.24064},
                {6.20777,0.975782,4.06064,4.10377,4.60925,4.72128,4.55863,0.044307,5.09548,2.44823},
                {6.70465,1.05438,4.41377,4.48414,4.9745,5.14132,4.92247,0.0443596,5.49925,2.64283},
                {7.24761,1.13243,4.80234,4.91326,5.36487,5.61168,5.32086,0.045329,5.93229,2.84632},
                {7.84319,1.21748,5.23296,5.40176,5.79241,6.14242,5.76113,0.0473751,6.4067,3.0687},
                {8.50043,1.31229,5.71474,5.9635,6.26523,6.7469,6.25132,0.0502945,6.93123,3.31519},
                {9.23096,1.41877,6.25885,6.61777,6.79187,7.44254,6.80094,0.0541849,7.51519,3.5903},
                {10.0498,1.53894,6.88014,7.39035,7.38252,8.25318,7.42207,0.0593504,8.17015,3.89939},
                {10.9756,1.67528,7.59813,8.31859,8.05031,9.21106,8.13043,0.0656513,8.9105,4.24905},
                {12.0332,1.83118,8.43904,9.45658,8.81218,10.3628,8.94669,0.0737702,9.75529,4.64811},
                {13.2548,2.01091,9.43966,10.8872,9.69048,11.7761,9.89911,0.084077,10.7293,5.10791},
                {14.6847,2.22077,10.6527,12.7434,10.7157,13.5546,11.0261,0.0973265,11.8665,5.64433},
                {16.3835,2.46884,12.1564,15.2526,11.9295,15.8649,12.3829,0.115273,13.2133,6.27873},
                {18.4389,2.76696,14.0732,18.8394,13.3914,18.9926,14.0497,0.140413,14.8359,7.04164},
                {20.9798,3.13231,16.6046,24.3979,15.1883,23.4726,16.1503,0.178258,16.8316,7.97768},
                {24.2066,3.59117,20.1085,34.1891,17.454,30.4359,18.8828,0.241348,19.3494,9.15499},
                {28.4465,4.18527,25.2873,56.0657,20.4033,42.7613,22.5885,0.367568,22.6297,10.6826},
                {34.2743,4.98591,33.7334,148.784,24.4063,70.5768,27.9079,0.746596,27.0868,12.7471},
                {42.7998,6.12497,49.9925,242.684,30.1587,192.859,36.2008,540.675,33.502,15.696},
                {56.4813,7.87664,94.3309,67.9758,39.1405,278.971,50.9513,0.765854,43.5428,20.2586},
                {82.0636,10.9216,704.65,39.8876,55.1574,82.2554,84.5707,0.388379,61.5214,28.2709},
                {147.149,17.5414,132.281,28.3956,91.8587,48.666,237.974,0.262406,103.075,46.0529},
                {655.45,43.0388,61.1585,22.1402,262.829,34.7565,307.32,0.199263,303.456,119.572},
                {275.191,101.874,40.0496,18.2033,319.822,27.1443,94.7303,0.161391,336.098,212.591},
                {115.063,23.6979,29.916,15.4952,100.814,22.3387,56.4452,0.136117,109.644,57.1172},
                {73.2444,13.5209,23.9599,13.5167,60.3026,19.0264,40.4131,0.117917,66.0105,33.258},
                {53.9757,9.51069,20.0368,12.0069,43.2389,16.6033,31.5953,0.104363,47.4613,23.5839},
                {42.8834,7.36384,17.2554,10.816,33.8287,14.7523,26.0127,0.0937025,37.1882,18.3399},
                {35.6693,6.02595,15.1793,9.8518,27.8623,13.2911,22.1582,0.0851725,30.6583,15.0479},
                {30.5987,5.11123,13.5693,9.05483,23.7385,12.1075,19.3351,0.0781857,26.138,12.7873},
                {26.8375,4.44615,12.2833,8.3845,20.7162,11.1287,17.1768,0.072317,22.8211,11.1381},
                {23.9345,3.9404,11.2319,7.81244,18.4045,10.3051,15.4721,0.0673064,20.282,9.88098},
                {21.6247,3.54259,10.3556,7.31828,16.578,9.60213,14.0907,0.0630749,18.2744,8.89032},
                {19.7419,3.22129,9.61368,6.88687,15.0976,8.99476,12.9479,0.0593077,16.6463,8.08903},
                {18.1768,2.95617,8.97701,6.5067,13.8726,8.46435,11.9864,0.0560434,15.2986,7.42714},
                {16.8545,2.73365,8.42432,6.16901,12.8417,7.9969,11.1654,0.0531633,14.1639,6.87092},
                {15.7219,2.54403,7.93982,5.86686,11.9615,7.58162,10.4561,0.0505775,13.1949,6.39658},
                {14.7404,2.38048,7.51132,5.5948,11.2008,7.21002,9.83667,0.048262,12.3573,5.98713},
                {13.8812,2.23786,7.12951,5.34839,10.5366,6.87537,9.29081,0.0461502,11.6257,5.62987},
                {13.1223,2.11232,6.78697,5.12416,9.95125,6.57233,8.80591,0.0442269,10.9807,5.31526},
                {12.4469,2.00094,6.47775,4.91896,9.43122,6.29648,8.37205,0.04247,10.4077,5.03599},
                {11.8416,1.90138,6.19712,4.73055,8.96591,6.0441,7.98143,0.0408474,9.89495,4.78627},
                {11.2958,1.81184,5.94117,4.55681,8.54698,5.81234,7.62767,0.0393856,9.4332,4.56151},
                {10.8008,1.73081,5.70665,4.39602,8.16759,5.59859,7.30567,0.038015,9.01497,4.35814},
                {10.3498,1.6571,5.49091,4.24673,7.82231,5.40081,7.01123,0.0366986,8.63429,4.17304},
                {9.93678,1.58975,5.29171,4.1077,7.50651,5.21719,6.74082,0.0355502,8.28612,4.00388},
                {9.55715,1.52793,5.10706,3.97788,7.21655,5.04613,6.4915,0.0344009,7.96633,3.84861},
                {9.20684,1.47099,4.93548,3.85621,6.94917,4.88642,6.26082,0.0334193,7.67148,3.70548},
                {8.88242,1.41829,4.77548,3.74209,6.70182,4.73684,6.0467,0.0324028,7.39865,3.57309},
                {8.58102,1.36943,4.62592,3.63471,6.47221,4.59647,5.84728,0.0315132,7.14539,3.45027},
                {8.30016,1.32392,4.48573,3.53346,6.25833,4.46435,5.66114,0.03064,6.90952,3.33586},
                {8.03776,1.28154,4.35402,3.43778,6.05874,4.33983,5.48675,0.0298122,6.68929,3.22917},
                {7.7919,1.24174,4.23002,3.34721,5.87184,4.22214,5.32315,0.0290506,6.48312,3.12921},
                {7.56109,1.20452,4.11297,3.26135,5.69641,4.11074,5.16927,0.0283723,6.28958,3.03547},
                {7.34381,1.16944,4.00237,3.17977,5.53142,4.00509,5.02417,0.0275795,6.10755,2.9473},
                {7.13888,1.13646,3.89758,3.10216,5.3759,3.90484,4.88711,0.0269347,5.93594,2.86418},
                {6.94524,1.10524,3.79819,3.02826,5.22896,3.80942,4.75739,0.0263309,5.77383,2.78573},
                {6.76189,1.07574,3.70363,2.95771,5.08992,3.71846,4.63447,0.0257119,5.62039,2.71144},
                {6.58802,1.04775,3.61371,2.89031,4.95808,3.63172,4.51774,0.025164,5.47495,2.64107},
                {6.42277,1.02127,3.52798,2.82583,4.83298,3.54885,4.40658,0.0245833,5.33684,2.57424},
                {6.26554,0.996011,3.44616,2.76407,4.71394,3.46953,4.3008,0.0240652,5.20542,2.51056},
                {6.11571,0.971953,3.36792,2.70486,4.60047,3.3936,4.19984,0.0235617,5.08024,2.45016},
                {5.97279,0.948997,3.29306,2.64802,4.49229,3.32077,4.10341,0.023055,4.96085,2.39241},
                {5.8362,0.927102,3.22132,2.59339,4.38895,3.25089,4.0112,0.0225829,4.84677,2.33726},
                {5.70551,0.906154,3.15253,2.54079,4.29012,3.1837,3.92285,0.0221215,4.73771,2.28454},
                {5.5803,0.886098,3.08644,2.49027,4.19546,3.11907,3.83815,0.0217345,4.63322,2.23402},
                {5.4602,0.866874,3.0229,2.44147,4.1047,3.05689,3.7569,0.0212772,4.53304,2.18559},
                {5.34494,0.848414,2.96181,2.39441,4.0176,2.99688,3.67877,0.0208952,4.43687,2.13912},
                {5.23416,0.830707,2.90293,2.34897,3.93394,2.93908,3.60364,0.0205363,4.34452,2.0945},
                {5.12756,0.813656,2.84614,2.30509,3.8534,2.88318,3.53134,0.0200917,4.25565,2.05156},
                {5.02493,0.797278,2.7914,2.26265,3.77595,2.82927,3.46163,0.0197625,4.17012,2.01026},
                {4.92598,0.78143,2.73849,2.22158,3.70123,2.77705,3.39441,0.0193859,4.08764,1.97042},
                {4.83055,0.766218,2.6873,2.18179,3.62923,2.72656,3.32947,0.0190581,4.00815,1.93203},
                {4.73839,0.751486,2.63798,2.14322,3.55967,2.67767,3.26679,0.0187386,3.93138,1.89493},
                {4.64933,0.737297,2.59006,2.10587,3.49254,2.63025,3.20616,0.018413,3.85725,1.85917},
                {4.56319,0.723511,2.54372,2.06958,3.42751,2.5843,3.14749,0.0180966,3.78551,1.82452},
                {4.47989,0.710252,2.49877,2.03435,3.3647,2.5397,3.09068,0.0177818,3.71612,1.791},
                {4.39913,0.697372,2.45515,2.00012,3.30382,2.49639,3.03563,0.0175029,3.64893,1.75857},
                {4.32089,0.684889,2.41286,1.96687,3.24485,2.45433,2.98227,0.0172128,3.58381,1.72712},
                {4.24504,0.67279,2.37177,1.93446,3.18766,2.4134,2.93043,0.0169315,3.52066,1.69666},
                {4.17138,0.661058,2.33183,1.903,3.13214,2.3736,2.88016,0.0166319,3.45938,1.66707},
                {4.09987,0.649655,2.29301,1.87231,3.07829,2.3349,2.83127,0.0163924,3.3999,1.63837},
                {4.03037,0.638599,2.25523,1.84244,3.0259,2.29718,2.78379,0.0161213,3.34207,1.61045},
                {3.96278,0.627832,2.21843,1.8133,2.97502,2.26045,2.73755,0.0158802,3.28591,1.58336},
                {3.8971,0.617378,2.18263,1.78488,2.92556,2.22464,2.69258,0.0156662,3.23123,1.55697},
                {3.83312,0.607211,2.1477,1.75719,2.87737,2.1897,2.64881,0.0153888,3.17807,1.53134},
                {3.77081,0.597282,2.11371,1.73013,2.83048,2.15563,2.60614,0.0151744,3.12628,1.50631},
                {3.71013,0.587601,2.08051,1.70371,2.78477,2.12235,2.56455,0.0149317,3.07584,1.48201},
                {3.65096,0.578224,2.04812,1.67786,2.74025,2.08988,2.52399,0.0147123,3.02665,1.45827},
                {3.59323,0.569018,2.0165,1.65264,2.69678,2.05814,2.48445,0.0144781,2.97864,1.43512},
                {3.53693,0.560027,1.9856,1.628,2.65444,2.02713,2.44577,0.0142565,2.93191,1.41261},
                {3.48196,0.55128,1.9554,1.60384,2.61312,1.99681,2.40816,0.0140645,2.8861,1.39041},
                {3.42831,0.542882,1.92589,1.58024,2.57272,1.96714,2.37118,0.0138533,2.84156,1.36913},
                {3.37579,0.534424,1.89703,1.55712,2.53313,1.93809,2.33532,0.0136581,2.79796,1.34793},
                {3.32447,0.526321,1.86872,1.53446,2.4946,1.90974,2.30001,0.0134663,2.75538,1.32744},
                {3.27437,0.518337,1.84122,1.51236,2.45688,1.88176,2.26559,0.0132375,2.71374,1.30736},
                {3.22526,0.51053,1.81412,1.49045,2.41997,1.85472,2.23187,0.013128,2.67299,1.28767},
                {3.17728,0.502926,1.78769,1.46946,2.38388,1.82782,2.19886,0.0128385,2.63311,1.26847},
                {3.13022,0.495441,1.76168,1.44838,2.3485,1.80168,2.16657,0.0127319,2.59406,1.24965},
                {3.0842,0.488155,1.73624,1.4279,2.31393,1.776,2.1349,0.0125057,2.55583,1.23119},
                {3.03912,0.480987,1.71131,1.40777,2.28001,1.7508,2.10389,0.0123672,2.51837,1.21315},
                {2.99491,0.473982,1.68687,1.38803,2.24677,1.72609,2.07345,0.0121942,2.4817,1.19546},
                {2.95158,0.467061,1.66286,1.36866,2.21419,1.70181,2.04364,0.0120228,2.44571,1.17808},
                {2.90907,0.460362,1.6393,1.34965,2.18224,1.67796,2.01437,0.011833,2.41044,1.16109},
                {2.86735,0.453711,1.61619,1.33094,2.15091,1.6546,1.98567,0.0117153,2.37582,1.1444},
                {2.82643,0.447222,1.59346,1.31258,2.12012,1.63161,1.95752,0.0115267,2.34185,1.12804},
                {2.78628,0.440872,1.57114,1.29455,2.08994,1.60899,1.92981,0.0113375,2.30851,1.11195},
                {2.74678,0.434566,1.54922,1.27676,2.06032,1.58682,1.90262,0.0112247,2.27579,1.09616},
                {2.70805,0.428419,1.52769,1.25931,2.03117,1.56497,1.87596,0.0110718,2.24359,1.08069},
                {2.66997,0.422407,1.50653,1.24215,2.00257,1.54349,1.8497,0.0109288,2.21201,1.06545},
                {2.63253,0.416467,1.48571,1.22521,1.97447,1.52235,1.8239,0.0107605,2.18095,1.05048},
                {2.59577,0.410651,1.46518,1.2086,1.94682,1.50158,1.79851,0.0106194,2.15047,1.03577},
                {2.55957,0.404907,1.44506,1.19222,1.91965,1.48108,1.77358,0.0104916,2.1204,1.0213},
                {2.524,0.399267,1.42522,1.17606,1.89292,1.46098,1.74903,0.0103437,2.09091,1.00707},
                {2.48899,0.393681,1.40569,1.1602,1.86662,1.44113,1.72485,0.0101978,2.06184,0.993071},
                {2.4545,0.388241,1.38647,1.14456,1.84073,1.42163,1.70111,0.0100575,2.03327,0.979276},
                {2.42063,0.382856,1.36754,1.12912,1.81529,1.40236,1.67769,0.00997493,2.00515,0.965771},
                {2.38719,0.377576,1.34887,1.11397,1.79019,1.38338,1.65462,0.00979844,1.97745,0.95238},
                {2.35432,0.37235,1.33053,1.09894,1.76547,1.36467,1.63194,0.00963252,1.95016,0.939244},
                {2.32188,0.36724,1.31236,1.08421,1.74115,1.34619,1.60956,0.00957572,1.92329,0.926306},
                {2.28999,0.362177,1.29463,1.06962,1.7172,1.32809,1.58751,0.00935151,1.89683,0.91356},
                {2.25845,0.357175,1.27688,1.05521,1.69356,1.31019,1.5658,0.00928993,1.87075,0.900993},
                {2.22751,0.352315,1.2596,1.04106,1.67028,1.29247,1.54421,0.00914486,1.84504,0.888467},
                {2.1968,0.347363,1.24246,1.02708,1.64723,1.27505,1.52316,0.00905473,1.81968,0.876488},
                {2.16676,0.342626,1.22556,1.01324,1.62464,1.25783,1.5024,0.00889944,1.79455,0.864237},
                {2.137,0.337925,1.20885,0.999598,1.60235,1.24083,1.48182,0.00880833,1.76997,0.852419},
                {2.10759,0.333266,1.1925,0.986156,1.58027,1.22407,1.46152,0.0086726,1.74562,0.840658},
                {2.07866,0.328671,1.17621,0.972856,1.55855,1.20745,1.4415,0.00853236,1.72158,0.829108},
                {2.05005,0.324177,1.16016,0.959741,1.5371,1.19113,1.42174,0.00844419,1.69789,0.817701},
                {2.02183,0.319695,1.14431,0.946777,1.51591,1.17496,1.40222,0.00832136,1.67449,0.806431},
                {1.99393,0.315262,1.12872,0.933904,1.49496,1.15901,1.38296,0.00821332,1.65136,0.79527},
                {1.96638,0.310899,1.11324,0.921266,1.47429,1.14323,1.36392,0.0081141,1.62857,0.784319},
                {1.93926,0.306634,1.09795,0.908723,1.45394,1.12765,1.3451,0.00800052,1.60603,0.773443},
                {1.91237,0.302338,1.08287,0.896382,1.43374,1.11221,1.32652,0.00789272,1.58373,0.762709},
                {1.88582,0.298164,1.06794,0.884092,1.41384,1.09701,1.30818,0.00779139,1.56177,0.752101},
                {1.85959,0.294003,1.05319,0.872031,1.39413,1.08189,1.29001,0.00765328,1.54001,0.741644},
                {1.83365,0.289909,1.03866,0.860046,1.37469,1.06699,1.27204,0.00756584,1.51851,0.731286},
                {1.808,0.285816,1.02421,0.848146,1.35543,1.05226,1.25434,0.00745483,1.49726,0.721036},
                {1.78266,0.281858,1.00994,0.836466,1.33644,1.03767,1.23676,0.00734453,1.47624,0.710924},
                {1.75756,0.277862,0.995828,0.824871,1.31762,1.02327,1.2194,0.00728133,1.45548,0.700891},
                {1.73276,0.273943,0.981859,0.813366,1.29896,1.00895,1.20226,0.00715763,1.43489,0.690983},
                {1.70823,0.27005,0.968052,0.802015,1.28059,0.994813,1.18525,0.00708163,1.41457,0.681205},
                {1.68395,0.266198,0.954322,0.790753,1.26235,0.980804,1.16844,0.00699473,1.39445,0.671503},
                {1.65991,0.262396,0.94078,0.779585,1.24433,0.966968,1.1518,0.00686689,1.37455,0.661921},
                {1.63608,0.258615,0.927413,0.768553,1.22649,0.953242,1.13532,0.00679781,1.3548,0.652424},
                {1.61257,0.254894,0.91414,0.757635,1.20882,0.939657,1.11899,0.0066804,1.33532,0.643021},
                {1.58921,0.251218,0.900975,0.746758,1.19132,0.9262,1.10287,0.00656241,1.31597,0.633714},
                {1.56614,0.247548,0.887973,0.736088,1.17402,0.912831,1.08687,0.00646912,1.29682,0.624479},
                {1.54325,0.243981,0.875035,0.725455,1.15686,0.899643,1.07101,0.00639906,1.27788,0.615382},
                {1.52059,0.240348,0.86229,0.714883,1.13983,0.886553,1.05531,0.00627854,1.25911,0.606325},
                {1.49816,0.236804,0.84962,0.704541,1.12298,0.873524,1.03978,0.00621316,1.24053,0.597401},
                {1.47592,0.233264,0.837062,0.694134,1.10632,0.860731,1.02437,0.0061028,1.22209,0.588478},
                {1.45387,0.229807,0.824614,0.683858,1.08979,0.847946,1.00909,0.00604013,1.20384,0.579705},
                {1.43199,0.226361,0.812232,0.673672,1.07341,0.83532,0.993956,0.00594387,1.18574,0.570971},
                {1.4103,0.222934,0.800032,0.663547,1.05718,0.822765,0.978964,0.005846,1.16782,0.562299},
                {1.38885,0.219565,0.787901,0.653558,1.04107,0.810321,0.964011,0.00575421,1.15001,0.553793},
                {1.36758,0.216138,0.775876,0.643634,1.02505,0.797985,0.949281,0.00565492,1.13234,0.545229},
                {1.34651,0.212834,0.763962,0.63377,1.00929,0.785757,0.934665,0.00561303,1.11489,0.536852},
                {1.32552,0.2095,0.752016,0.623997,0.993545,0.773577,0.920102,0.00550288,1.0975,0.528486},
                {1.30474,0.206194,0.740374,0.614322,0.977958,0.76157,0.905727,0.00544965,1.0803,0.520149},
                {1.28413,0.202951,0.728696,0.604708,0.96248,0.749559,0.891449,0.00534774,1.06323,0.511968},
                {1.26367,0.199702,0.717144,0.595116,0.94716,0.737724,0.877241,0.0052391,1.0463,0.503811},
                {1.24334,0.196489,0.705631,0.585617,0.931903,0.725963,0.863188,0.00517958,1.02943,0.495725},
                {1.22318,0.193337,0.694258,0.576174,0.9168,0.714231,0.849201,0.00507195,1.01277,0.487677},
                {1.20321,0.190143,0.682958,0.566857,0.901835,0.702648,0.835325,0.00499747,0.996192,0.479697},
                {1.18337,0.187027,0.671703,0.557544,0.886928,0.691106,0.821581,0.00490345,0.979785,0.471781},
                {1.16366,0.183897,0.660549,0.548328,0.872174,0.679661,0.807868,0.00486134,0.963444,0.463921},
                {1.14409,0.180797,0.649464,0.539165,0.857475,0.668267,0.794312,0.00477859,0.947229,0.456089},
                {1.12463,0.177725,0.638472,0.530038,0.842893,0.656994,0.780831,0.00467808,0.931115,0.448344},
                {1.10535,0.174675,0.627538,0.520986,0.828437,0.645737,0.767428,0.00459242,0.915153,0.440653},
                {1.08616,0.171632,0.616681,0.512012,0.814035,0.634605,0.754111,0.00451371,0.899243,0.433014},
                {1.06708,0.168639,0.605892,0.503054,0.799774,0.623507,0.740912,0.00443803,0.883501,0.425402},
                {1.04816,0.165648,0.595149,0.494203,0.785585,0.612465,0.727759,0.00435895,0.867795,0.417854},
                {1.02933,0.162646,0.584489,0.485351,0.771451,0.601544,0.71471,0.00427133,0.852196,0.410325},
                {1.01062,0.159717,0.57388,0.476593,0.75745,0.590663,0.701748,0.00419181,0.836726,0.402889},
                {0.992073,0.156765,0.563394,0.467871,0.743512,0.579828,0.688833,0.0041113,0.821325,0.395487},
                {0.973546,0.153833,0.552901,0.459189,0.729651,0.569067,0.676058,0.00403712,0.806005,0.388083},
                {0.955226,0.150945,0.542497,0.450571,0.715915,0.558372,0.663289,0.00398862,0.790829,0.380799},
                {0.936918,0.148053,0.532123,0.442007,0.702188,0.547729,0.650623,0.00392498,0.775671,0.373504},
                {0.91877,0.145178,0.521842,0.433449,0.68858,0.537133,0.638025,0.00381877,0.760648,0.366209},
                {0.900728,0.142332,0.511576,0.424953,0.675039,0.526628,0.625468,0.00376154,0.7457,0.359061},
                {0.882718,0.139473,0.501407,0.416503,0.661552,0.516155,0.613022,0.00368429,0.730798,0.351874},
                {0.864879,0.136662,0.491321,0.408091,0.648162,0.50571,0.600581,0.00359307,0.716014,0.34475},
                {0.847083,0.133832,0.481209,0.39973,0.63483,0.495409,0.588253,0.00351932,0.701269,0.337661},
                {0.829416,0.131064,0.471159,0.391436,0.621585,0.485034,0.575977,0.00344846,0.686662,0.330618},
                {0.811775,0.128239,0.461177,0.383136,0.608375,0.474759,0.563717,0.00338925,0.672052,0.323597},
                {0.794237,0.125534,0.45124,0.374902,0.595238,0.464558,0.55156,0.00329863,0.65753,0.31664},
                {0.776791,0.122765,0.441345,0.366707,0.582287,0.454361,0.539478,0.00322542,0.643122,0.309622},
                {0.759483,0.119996,0.431509,0.358516,0.569149,0.444258,0.5274,0.00316045,0.628763,0.302794},
                {0.742176,0.117244,0.421703,0.350393,0.556221,0.434141,0.515453,0.00309809,0.614441,0.295828},
                {0.724995,0.114499,0.411993,0.342247,0.543308,0.424162,0.503511,0.00299991,0.600174,0.28894},
                {0.707886,0.111671,0.402193,0.334204,0.53038,0.414102,0.4916,0.00292382,0.585922,0.282005},
                {0.690857,0.10923,0.392553,0.326187,0.517822,0.404146,0.47966,0.00286382,0.572021,0.275486},
                {0.673836,0.106515,0.382896,0.318151,0.50502,0.394215,0.468124,0.00277318,0.55788,0.268629},
                {0.656879,0.103796,0.37323,0.310194,0.492325,0.384319,0.45631,0.00272839,0.543859,0.2619},
                {0.640041,0.101146,0.36372,0.302238,0.479702,0.374374,0.444578,0.00265795,0.529915,0.255148},
                {0.623291,0.0985031,0.354202,0.294228,0.467118,0.364815,0.432894,0.00274658,0.516012,0.248444},
                {0.606564,0.0958493,0.344717,0.286621,0.454578,0.35498,0.421309,0.00253323,0.502153,0.241775},
                {0.589891,0.0932214,0.33525,0.278677,0.442077,0.345228,0.409724,0.00249279,0.488357,0.235143},
                {0.573304,0.0905881,0.325814,0.270821,0.429657,0.335499,0.398168,0.00241841,0.474631,0.228535},
                {0.556743,0.0879657,0.31644,0.263023,0.417211,0.325828,0.386706,0.00231425,0.460889,0.221924},
                {0.540254,0.0853859,0.307032,0.255187,0.404881,0.316202,0.375262,0.0022565,0.447272,0.215353},
                {0.52381,0.0827681,0.297689,0.247481,0.392552,0.306561,0.363852,0.00217862,0.433615,0.208811},
                {0.507431,0.0802128,0.288393,0.239721,0.380279,0.296996,0.352421,0.00211435,0.420063,0.202255},
                {0.491037,0.0776012,0.279096,0.232012,0.367987,0.287436,0.341087,0.00205363,0.406512,0.195755},
                {0.47476,0.0750145,0.269879,0.224316,0.355787,0.277921,0.329767,0.00197688,0.393037,0.189231},
                {0.458534,0.0724525,0.260562,0.216662,0.343625,0.268398,0.31851,0.00192617,0.379593,0.182775},
                {0.442301,0.0699049,0.251435,0.20901,0.331455,0.258921,0.307244,0.0018497,0.366152,0.176301},
                {0.426147,0.0673306,0.242237,0.201348,0.319363,0.249493,0.296025,0.00177071,0.352784,0.169859},
                {0.410022,0.0647904,0.233058,0.193797,0.307294,0.240019,0.284798,0.001715,0.339443,0.163439},
                {0.393939,0.0622365,0.223932,0.186146,0.295223,0.230653,0.273644,0.00163646,0.32612,0.157011},
                {0.377887,0.0597137,0.214792,0.178607,0.283174,0.221236,0.262519,0.00158276,0.312827,0.150626},
                {0.3619,0.0571892,0.205699,0.171015,0.271211,0.211863,0.251386,0.00153208,0.299568,0.144274},
                {0.345925,0.054647,0.196647,0.163477,0.259228,0.202515,0.240287,0.00144583,0.286379,0.137896},
                {0.329962,0.0521406,0.187596,0.155957,0.247272,0.193208,0.229218,0.00141182,0.273148,0.131537},
                {0.314063,0.0496155,0.178538,0.148441,0.235352,0.183852,0.218149,0.00131033,0.259973,0.125181},
                {0.29818,0.0471144,0.169535,0.140914,0.223444,0.174618,0.20712,0.00125184,0.24684,0.118843},
                {0.282383,0.0446472,0.160461,0.133447,0.211632,0.165305,0.196129,0.00116397,0.23378,0.11261},
                {0.266144,0.041748,0.151497,0.125964,0.19928,0.156034,0.185127,0.00109189,0.220154,0.105774},
                {0.251419,0.0400391,0.142536,0.118505,0.18866,0.146779,0.173676,0.00105468,0.208313,0.100464},
                {0.234024,0.0366821,0.133331,0.111046,0.175293,0.137566,0.164001,0.000962481,0.193726,0.0930786},
                {0.219536,0.03479,0.125244,0.103576,0.16449,0.128403,0.151489,0.000923157,0.181702,0.0875854},
                {0.20331,0.0321274,0.11499,0.0962524,0.152393,0.118591,0.141602,0.000915527,0.16835,0.0810623},
                {0.187702,0.0296668,0.107056,0.0882568,0.140667,0.110657,0.130329,0.000549316,0.155374,0.0748031},
                {0.172002,0.02718,0.0976944,0.0819092,0.128902,0.100098,0.119477,0.00109863,0.142392,0.0685489},
                {0.156281,0.0246857,0.0888638,0.0732422,0.117113,0.0917664,0.108587,0.000427246,0.129374,0.0622936},
                {0.140635,0.0222342,0.0799584,0.0667114,0.105355,0.0823212,0.0976892,0.000656128,0.116415,0.0560426},
                {0.124957,0.0197402,0.0710505,0.0590439,0.0936465,0.0731979,0.0868182,0.00052166,0.103463,0.0498343},
                {0.109309,0.0172726,0.0621666,0.0517012,0.0819018,0.0640243,0.0759632,0.000457399,0.0905045,0.0435577},
                {0.0937092,0.014806,0.0532601,0.0442825,0.0702226,0.0548632,0.065081,0.000390461,0.0775706,0.0373555},
                {0.0780708,0.0123364,0.0443479,0.0368905,0.058495,0.0457226,0.0542335,0.000344177,0.0646225,0.0311103},
                {0.0624556,0.00987841,0.0354967,0.0295385,0.046801,0.0365757,0.0433635,0.000240734,0.051704,0.0249004},
                {0.0468037,0.00739615,0.0266254,0.0221314,0.0350732,0.027398,0.032557,0.000200398,0.0387582,0.0186497},
                {0.0312244,0.00494211,0.0177288,0.0147622,0.0234154,0.0182806,0.0216637,0.000138951,0.0258585,0.0124597},
                {0.0155944,0.00247347,0.00887489,0.00738835,0.0116765,0.0091575,0.0108371,6.6194e-05,0.012929,0.00621434}
            };
        }

        @Override
        public void paint(Graphics g) {
            super.paint(g);
            Dimension size = getSize();

            int xDim = 10;
            int yDim = VIEW_SIZE;

            int bx = size.width / xDim;
            int by = size.height / yDim;

            double min = 999999999999.0;
            double max = 0;
            for(int x = 0; x < xDim; ++x) {
                for(int y = 0; y < yDim; ++y) {
                    double value = test_data[y][x];
                    if(value < min) {
                        min = value;
                    }

                    if(value > max) {
                        max = value;
                    }
                }
            }

            for(int x = 0; x < xDim; ++x) {

                for(int y = 0; y < yDim; ++y) {
                    double value = test_data[y][x];
                    double v = log(1 + value*value);
                    double lmin = log(1 + min*min);
                    double lmax = log(1 + max*max);

                    double normalized = 1.0 - (v-lmin)/(lmax-lmin);
                    int color_index = (int)((colorspace.length - 1) * normalized);
                    Color color = colorspace[color_index];

                    colors[(VIEW_SIZE-1) - y] = color;
                    values[y] = ((float)y) / (float)VIEW_SIZE;
                }

                LinearGradientPaint lgp = new LinearGradientPaint(
                    new Point2D.Float(0, 0),
                    new Point2D.Float(0, size.height),
                    values,
                    colors
                );

                Graphics2D g2 = (Graphics2D) g;
                g2.setPaint(lgp);

                g.fillRect(x * bx, 0, bx, size.height);
            }



            for(int i = 0; i < yAxisHz.length; ++i) {
                int dy = size.height / yAxisHz.length;
                double hz = yAxisHz[i];

                int y = (yAxisHz.length - 1 - i) * dy;
                g.setColor(Color.BLACK);

                g.drawString(Double.valueOf(hz).toString(), 10, y);

                g.setColor(Color.GRAY);
                g.drawLine(50, y, size.width, y);
            }
        }
    }
}
